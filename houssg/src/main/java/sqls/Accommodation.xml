<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ssg.com.houssg.dao.AccommodationDao">
    <select id="getAllAccom" resultType="ssg.com.houssg.dto.AccommodationDto">
       	SELECT *
		FROM accommodation
		ORDER BY accom_number desc
    </select>

    <select id="getAccomType" parameterType="ssg.com.houssg.dto.AccommodationParam" resultType="ssg.com.houssg.dto.AccommodationDto">
    	SELECT a.*
    	FROM accommodation a
    	JOIN rooms r ON a.accom_number = r.accom_number
    	WHERE a.accom_category=#{type} and r.room_availability = 0
		ORDER BY accom_number desc
	</select>
	
	<select id="getAddressSearch" parameterType="ssg.com.houssg.dto.AccommodationParam" resultType="ssg.com.houssg.dto.AccommodationDto">
   		SELECT a.*
   	 	FROM accommodation a
   	 	JOIN rooms r ON a.accom_number = r.accom_number
   	 	WHERE a.accom_address like CONCAT('%', #{search}, '%')
	</select>
	
	<!-- (5) 숙소 등록 후 selectKey에 의해, autoIncrement된 accom_number 값이 반환됨 -->
	<insert id="addAccom" parameterType="ssg.com.houssg.dto.AccommodationDto">
    	INSERT INTO accommodation (accom_name, accom_address, tele_number, accom_category, accom_details, check_in, check_out, business_number, id, auth, approval_request, deletion_request, zip_code)
    	VALUES (#{accom_name}, #{accom_address}, #{tele_number}, #{accom_category}, #{accom_details}, #{check_in}, #{check_out}, #{business_number}, #{id}, 1, 0, 0, #{zip_code})
    	<selectKey keyProperty="accom_number" resultType="int" order="AFTER">
    		SELECT LAST_INSERT_ID()
    	</selectKey>
	</insert>
    
    
    

</mapper>

